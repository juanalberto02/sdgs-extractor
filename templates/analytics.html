<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analytics</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: '#0165a4',
            'brand-soft': '#e7f1fa',
          },
          boxShadow: { card: '0 6px 28px rgba(1,101,164,0.08)' },
          borderRadius: { xl2: '1.25rem' }
        }
      }
    }
  </script>
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    html,body{font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
  </style>
</head>
<body class="bg-white text-slate-800">
  <!-- NAVBAR (STATIC / TIDAK NGIKUT) -->
  <header class="bg-brand text-white shadow-sm">
    <div class="mx-auto max-w-7xl px-4 sm:px-6">
      <div class="flex h-16 items-center justify-between">
        <!-- Left: Logo -->
        <a href="/ekstraksi" class="flex items-center gap-3">
          <img src="/assets/img/Unair Branding.png" alt="UNAIR" class="h-9" />
        </a>
  
        <!-- Mobile toggle -->
        <button id="navToggle" class="md:hidden inline-flex items-center justify-center w-10 h-10 rounded-lg hover:bg-brand/80">
          <svg width="20" height="20" fill="none" viewBox="0 0 24 24" class="text-white">
            <path stroke="currentColor" stroke-width="2" d="M4 7h16M4 12h16M4 17h16"/>
          </svg>
        </button>
  
        <!-- Menu (Desktop) -->
        <nav id="navMenu" class="hidden md:flex items-center gap-6">
          <a href="/ekstraksi" class="text-white/90 hover:text-white transition text-sm">Extraction</a>
          <a href="/analytics" class="text-white/90 hover:text-white transition text-sm">Analytics</a>
          <a href="{{ request.url_for('logout') }}"
             class="ml-2 inline-flex items-center gap-2 rounded-full bg-white text-brand px-4 py-1.5 text-sm font-semibold hover:bg-white/90 transition shadow-sm">
            Logout
          </a>
        </nav>
      </div>
  
      <!-- Mobile dropdown -->
      <div id="navDropdown" class="md:hidden hidden border-t border-brand/20 py-2 bg-brand">
        <a href="/deteksi" class="block px-2 py-2 text-sm text-white/90 hover:text-white">Detection</a>
        <a href="/history" class="block px-2 py-2 text-sm text-white/90 hover:text-white">History</a>
        <a href="{{ request.url_for('logout') }}" class="block px-2 py-2 text-sm bg-white text-brand rounded-lg mt-1 text-center hover:bg-white/90">
          Logout
        </a>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="mx-auto max-w-7xl px-4 sm:px-6 pt-8 pb-10">
    <!-- Title -->
    <section class="mb-6 text-center">
      <h1 class="text-2xl sm:text-3xl font-semibold tracking-tight text-slate-800">ANALYTICS DASHBOARD</h1>
      <div class="mt-3 h-1 w-28 mx-auto rounded-full bg-brand"></div>
    </section>

    <!-- KPI Cards -->
    <section class="mb-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      <!-- Total Input -->
      <div class="rounded-2xl border border-slate-200 bg-white shadow-card p-5">
        <div class="flex items-start justify-between">
          <div>
            <div class="text-xs uppercase tracking-wide text-brand font-semibold mb-1">Total Input</div>
            <div class="text-2xl font-semibold text-slate-800">{{ total_input }}</div>
          </div>
          <div class="rounded-xl bg-brand-soft p-2">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="w-6 h-6 text-brand"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M3 12h18M3 6h18M3 18h18"/></svg>
          </div>
        </div>
      </div>
      <!-- Daily Input -->
      <div class="rounded-2xl border border-slate-200 bg-white shadow-card p-5">
        <div class="flex items-start justify-between">
          <div>
            <div class="text-xs uppercase tracking-wide text-emerald-600 font-semibold mb-1">Daily Input</div>
            <div class="text-2xl font-semibold text-slate-800">{{ daily_input }}</div>
          </div>
          <div class="rounded-xl bg-emerald-50 p-2">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="w-6 h-6 text-emerald-600"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M8 7v10M12 5v14M16 9v6"/></svg>
          </div>
        </div>
      </div>
      <!-- Avg Similarity -->
      <div class="rounded-2xl border border-slate-200 bg-white shadow-card p-5">
        <div class="flex items-start justify-between">
          <div class="w-full">
            <div class="flex items-center justify-between mb-2">
              <div class="text-xs uppercase tracking-wide text-sky-600 font-semibold">Avg Similarity</div>
              <div class="text-2xl font-semibold text-slate-800">{{ avg_similarity }}%</div>
            </div>
            <div class="w-full h-2.5 rounded-full bg-slate-100 overflow-hidden">
              <div class="h-full rounded-full bg-sky-500" style="width: {{ avg_similarity }}%"></div>
            </div>
          </div>
          <div class="ml-3 rounded-xl bg-sky-50 p-2">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="w-6 h-6 text-sky-600"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M4 6h16M4 12h10M4 18h6"/></svg>
          </div>
        </div>
      </div>
    </section>

    <!-- Chart: Total Input -->
    <section class="mb-8">
      <div class="rounded-2xl border border-slate-200 bg-white shadow-card overflow-hidden">
        <div class="flex items-center justify-between px-4 sm:px-6 py-3 border-b border-slate-200">
          <h3 class="text-slate-800 font-semibold">Total Input (<span id="filterLabel">Monthly</span>)</h3>
          <select id="chartFilter" class="rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-4 focus:ring-brand/20 focus:border-brand">
            <option value="monthly" selected>Monthly</option>
            <option value="weekly" selected>Weekly</option>
            <option value="daily">Daily</option>
          </select>
        </div>
        <div class="p-4 sm:p-6">
          <div class="h-[360px]"><canvas id="inputChart"></canvas></div>
        </div>
      </div>
    </section>

    <!-- SDGs + Pillar -->
    <section class="grid grid-cols-1 lg:grid-cols-12 gap-4">
      <!-- SDGs -->
      <div class="lg:col-span-7 xl:col-span-8">
        <div class="rounded-2xl border border-slate-200 bg-white shadow-card overflow-hidden">
          <div class="px-4 sm:px-6 py-3 border-b border-slate-200">
            <h3 class="text-slate-800 font-semibold">SDGs</h3>
          </div>
          <div class="p-4 sm:p-6" id="sdg-progress-bars"></div>
        </div>
      </div>
      <!-- Pillar -->
      <div class="lg:col-span-5 xl:col-span-4">
        <div class="rounded-2xl border border-slate-200 bg-white shadow-card overflow-hidden">
          <div class="px-4 sm:px-6 py-3 border-b border-slate-200">
            <h3 class="text-slate-800 font-semibold">Pillar</h3>
          </div>
          <div class="p-4 sm:p-6">
            <div class="h-[320px]"><canvas id="pillarChart"></canvas></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER (match Extraction) -->
  <footer class="mt-auto text-center py-8 bg-brand text-white">
    <div class="mx-auto max-w-7xl px-4 sm:px-6">
      <img src="assets/img/Unair Branding.png" class="h-12 mx-auto mb-3" alt="UNAIR" />

      <ul class="flex items-center justify-center gap-4 mb-3">
        <li>
          <a href="https://x.com/Unair_Official" target="_blank" rel="noopener" aria-label="X (Twitter)"
             class="inline-flex items-center justify-center w-10 h-10 rounded-full border border-white/30 hover:bg-white/10 transition">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-white">
              <path d="M4 4l11.733 16h4.267L8.267 4z"></path>
              <path d="M4 20l6.768-6.768m2.46-2.46l6.772-6.772"></path>
            </svg>
          </a>
        </li>
        <li>
          <a href="https://www.instagram.com/univ_airlangga/" target="_blank" rel="noopener" aria-label="Instagram"
             class="inline-flex items-center justify-center w-10 h-10 rounded-full border border-white/30 hover:bg-white/10 transition">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-white">
              <path d="M4 8a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H8a4 4 0 0 1-4-4V8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M16.5 7.5h.01"></path>
            </svg>
          </a>
        </li>
        <li>
          <a href="https://www.youtube.com/channel/UCUYwloXmWyNZplsqg4MVERw" target="_blank" rel="noopener" aria-label="YouTube"
             class="inline-flex items-center justify-center w-10 h-10 rounded-full border border-white/30 hover:bg-white/10 transition">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-white">
              <rect x="2" y="4" width="20" height="16" rx="4"></rect>
              <path d="M10 9l5 3-5 3z"></path>
            </svg>
          </a>
        </li>
      </ul>

      <div class="text-xs sm:text-sm opacity-90">Copyright © 2025 UNAIR</div>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const dummyData = {{ chart_data | safe }};

    // Initial chart setup
    const ctx = document.getElementById('inputChart').getContext('2d');
    let chartMode = 'monthly';
    let inputChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: dummyData[chartMode].labels,
        datasets: [{
          label: 'Total Input',
          data: dummyData[chartMode].data,
          backgroundColor: 'rgba(1, 101, 164, 0.08)',
          borderColor: '#0165a4',
          fill: true,
          tension: 0.4,
          pointRadius: 3,
        }]
      },
      options: {
        maintainAspectRatio: false,
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          x: { grid: { display: false }, ticks: { color: '#64748b' } },
          y: { grid: { color: '#eef2f7' }, ticks: { color: '#64748b' } }
        }
      }
    });

    // Change chart data on filter
    document.getElementById('chartFilter').addEventListener('change', function(){
      chartMode = this.value;
      inputChart.data.labels = dummyData[chartMode].labels;
      inputChart.data.datasets[0].data = dummyData[chartMode].data;
      document.getElementById('filterLabel').innerText = chartMode.charAt(0).toUpperCase() + chartMode.slice(1);
      inputChart.update();
    });
  </script>
  <script>
    const sdgCounts = {{ sdg_count | safe }};
    const sdgLabels = [
      'No Poverty','Zero Hunger','Good Health and Well-being','Quality Education','Gender Equality',
      'Clean Water and Sanitation','Affordable and Clean Energy','Decent Work and Economic Growth',
      'Industry, Innovation and Infrastructure','Reduced Inequalities','Sustainable Cities and Communities',
      'Responsible Consumption and Production','Climate Action','Life Below Water','Life on Land',
      'Peace, Justice and Strong Institutions','Partnerships for the Goals'
    ];
    const total = sdgCounts.reduce((a,b)=>a+b,0);
    let sdgArr = sdgCounts.map((jumlah,i)=>({ label: `SDGs ${String(i+1).padStart(2,'0')} - ${sdgLabels[i]}`, jumlah })).sort((a,b)=>b.jumlah-a.jumlah).slice(0,7);

    let html = '';
    sdgArr.forEach(item=>{
      const persen = total ? Math.round((item.jumlah/total)*100) : 0;
      html += `
        <div class="mb-4">
          <div class="flex items-center justify-between text-sm mb-1">
            <span class="text-slate-700">${item.label}</span>
            <span class="font-medium text-slate-900">${persen}%</span>
          </div>
          <div class="w-full h-2 rounded-full bg-slate-100 overflow-hidden">
            <div class="h-full bg-brand rounded-full" style="width:${persen}%;"></div>
          </div>
        </div>
      `;
    });
    document.getElementById('sdg-progress-bars').innerHTML = html;
  </script>
  <script>
    window.addEventListener('DOMContentLoaded', function(){
      const pillarData = {{ pillar_distribution | tojson | safe }};
      const labels = Object.keys(pillarData || {});
      const values = Object.values(pillarData || {});
      const colors = ['#0165a4', '#1cc88a', '#36b9cc', '#f6c23e'];

      const ctx = document.getElementById('pillarChart').getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: { labels, datasets: [{ data: values, backgroundColor: colors, borderColor: '#ffffff' }] },
        options: { maintainAspectRatio: false, plugins: { legend: { display: true } } }
      });
    });
  </script>
</body>
</html>
